# coq-min-imports

Script to remove unnecessary module imports from _Coq_ sources. It removes modules found in *"Require Import"* statements one by one and tries to recompile to see if their removal caused compilation errors.

The easy way to run it is to replace __COQC__ variable in *Makefile* generated by *coq_makefile* with:

    COQC=coq-min-imports/coq_min_imports -cmi-verbose -cmi-wrap

And run the *make*. For each *.v* file where some imports where
removed, a modified version will be saved with *.v.new* extension. If
want to overwrite *.v* files rather than generate new versions, use
*-cmi-replace* option.

## Example:

    $ coq_min_imports -cmi-verbose -cmi-wrap  -q  -R "." Top -I "."   CarrierType.v
    Processing CarrierType.v
        -MathClasses.orders.orders
        +MathClasses.interfaces.orders
        +MathClasses.theory.rings
        +MathClasses.interfaces.abstract_algebra
        +CoLoR.Util.Vector.VecUtil
        -Ring
        -Coq.Bool.Bool
    Writing modified copy of CarrierType.v as CarrierType.v.new with 3 imports removed

In the verbose mode, used above, it prints each imported module it
attempts to remove. Modules marked with __+__ could not be removed,
and modules marked with __-__ will be removed.

## Usage: 

    coq_min_imports <coq_flags> [-cmi-verbose] [-cmi-replace] [-cmi-wrap] <files...>

where

* *__&lt;coq_flags>__* - any of optoins supported by *'coqc'*
* *__&lt;files>__* - list of *.v* files to process
* __-cmi-verbose__ - enable verbose reporting
* __-cmi-replace__ - replace processed files with optmized version (orignals are saved with the *".bak"* suffix). Otherwise optimized version is written as a new file with the same name as input but adding *".new"* suffix.
* __-cmi-wrap__ - run in a compiler wrapper mode, compiling the files as the side-effect


## Author

Vadim Zaliva <lord@crocodile.org>
